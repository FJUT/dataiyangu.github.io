title: ip报头，tcp报头，udp报头解析
author: Leesin.Dong
tags:
  - interview
  - 网络
categories:
  - 基础亦是进阶
  - 网络
date: 2018-11-09 09:23:00
---
**ip报头结构**


![upload successful](/images/my_blog_110.png)
版本号（Version）：标明了IP 协议的版本号，目前的协议版本号为4 。下一代IP 协议的版本号为6。

●报文长度：指 IP 包头部长度，占4 位。

●8 位的服务类型：包括一个3 位的优先权字段（COS，Class of Service），4 位TOS 字段和1 位未用位。4 位TOS 分别代表最小时延、最大吞吐量、最高可靠性和最小费用。

●总长度：是整个IP 数据报长度，包括数据部分。

●标识符：唯一地标识主机发送的每一份数据报。通常每发送一份报文它的值就会加1。

●生存时间：设置了数据包可以经过的路由器数目。一旦经过一个路由器，TTL 值就会减1，当该字段值为0 时，数据包将被丢弃。

●协议：确定在数据包内传送的上层协议，和端口号类似，IP 协议用协议号区分上层协议。TCP 协议的协议号为6，UDP 协议的协议号为17。

●报头校验和：计算IP 头部的校验和，检查报文头部的完整性。

●源IP 地址和目的IP 地址字段：标识数据包的源端设备和目的端设备。

●IP选项：一般格式为1个字节的代码，一个字节的长度，一个字节的指针，指针的值从1开始计数，指向IP选项的内容，一般其值为4(跳过了前面的代码&长度&指针的三个字节)，长度包括前面3个字节在内的整个IP选项，最大值为40。

UDP报头：


![upload successful](/images/my_blog_111.png)
●源、目标端口号字段：占16比特。作用与TCP数据段中的端口号字段相同，用来标识源端和目标端的应用进程。    

●长度字段：占16比特。标明UDP头部和UDP数据的总长度字节。    

●校验和字段：占16比特。用来对UDP头部和UDP数据进行校验。和TCP不同的是，对UDP来说，此字段是可选项，而TCP数据段中的校验和字段是必须有的

TCP报头：


![upload successful](/images/my_blog_112.png)

●头部长度字段：占4比特。给出头部占32比特的数目。由于TCP报头的长度随TCP选项字段内容的不同而变化，因此报头中包含一个指定报头字段的字段。该字段以32比特为单位，所以报头长度一定是32比特的整数倍，有时需要在报头末尾补0。如果报头没有TCP选项字段，则报头长度值为5，表示报头一个有160比特，即20字节。    

●标志位字段（U、A、P、R、S、F）：占6比特。各比特的含义如下：    

URG：报文段紧急。    

ACK：确认序号有效。    

PSH：接收方应该尽快将这个报文段交给应用层。    

 RST：重建连接。    

 SYN：发起一个连接。在握手完成后SYN为1，表示TCP建立已连接。此后的所有报文段中，SYN都被置0。

 FIN：释放一个连接。如果源主机数据发送完毕，将把该连接下要发送的最后一个报文段的报头中的FIN位置1，或将该报文段后面发送的报头中该位置1。    

●窗口大小字段：占16比特。此字段用来进行流量控制。单位为字节数，这个值是本机期望一次接收的字节数。接收计算机可接收的新数据字节的数量，根据接收缓冲区可用资源的大小，其值随计算机所发送的每个报文段而变化。源主机可以利用接收到的窗口值决定下一个报文段的大小。   

●TCP校验和字段：占16比特。对整个TCP报文段，即TCP头部和TCP数据进行校验和计算，并由目标端进行验证。    

●紧急指针字段：占16比特。它是一个偏移量，和序号字段中的值相加表示紧急数据最后一个字节的序号。如果URG为1，则紧急指针标志着紧急数据的结束。其值是紧急数据最后1字节的序号，表示报文段序号的偏移量。例如，如果报文段的序号是1000，前8个字节都是紧急数据，那么紧急指针就是8。紧急指针一般用途是使用户可中止进程。    

●选项字段：占32比特。可能包括"窗口扩大因子"、"时间戳"等选项。

●数据部分：报头后面是可选的报文段数据部分。IP协议标准要求株距能接收最长达576字节的数据报。无其他选项的IP报头是20字节，无其他选项的TCP报头也是20字节，所以IP选项和TCP选项且含有多达536字节数据的TCP报文段无须分片就可达到目的主机。

